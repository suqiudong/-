webpackJsonp([32,51],{12:function(e,a){"use strict";function t(e,a){var t={data:e.data||[],destroy:!0,scrollXInner:"100%",dom:e.dom||'<"top"f>rt<"bottom"lip>',columns:e.columns||[],language:{sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 条结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 条结果，共 _TOTAL_ 条",sInfoEmpty:"显示第 0 至 0 条结果，共 0 条",sInfoFiltered:"(由 _MAX_ 条结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},paging:e.paging&&!0,pageLength:e.pageLength||10,columnDefs:e.columnDefs||"",order:e.order||[],createdRow:e.createdRow||null,searching:e.searching&&!0,info:e.info&&!0,ordering:e.ordering&&!0};e.scrollX&&(t.scrollX=e.scrollX);var l=void 0;return l=a?$("#"+e.id).dataTable(t):$("#"+e.id).DataTable(t)}function l(e,a,t,l){$("#"+e+" tbody").off(a,t).on(a,t,l)}function i(e){var a=$("#"+e).DataTable().row($(this).parents("tr")).data();return a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t,a.bindTableEvent=l,a.getTableItem=i},13:function(e,a){"use strict";function t(e){$(e).iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",disabledClass:"disabled"})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t},583:function(e,a,t){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var i=t(5),n=l(i),s=t(143),d=l(s),r=t(6),o=l(r),c=t(3),u=l(c),m=t(4),p=l(m),f=t(8),v=l(f),h=t(7),g=l(h),b=t(2),y=(l(b),t(13)),N=l(y),T=t(12),x=l(T),_=t(10),w=t(149),k={},R="",H="",E='<select name="type" class="form-control"><option value="string">string</option><option value="long">long</option><option value="double">double</option><option value="date">date</option><option value="geo_point">geo_point</option><option value="nested">nested</option></select>',z='<select name="store" class="form-control"><option value="true">是</option><option value="false" selected>否</option></select>',D='<select name="index" class="form-control"><option value="true" selected>是</option><option value="false">否</option></select>',q='<select class="form-control" name="key"><option value="true">是</option><option value="false" selected>否</option></select>',C=(0,n.default)("option",{value:""},void 0,"请选择"),A=(0,n.default)("div",{className:"box-header with-border "},void 0,(0,n.default)("p",{className:"box-title"},void 0,"基本信息")),O=(0,n.default)("label",{htmlFor:"datasetName"},void 0,(0,n.default)("span",{className:"identify"},void 0,"* "),"名称 : "),F=(0,n.default)("span",{className:"messages"}),I=(0,n.default)("div",{name:"isPartition",className:"form-group col-md-3"},void 0,(0,n.default)("label",{htmlFor:"isPartition"},void 0,"是否分区 : "),(0,n.default)("div",{className:"radio"},void 0,(0,n.default)("label",{},void 0,(0,n.default)("input",{name:"isPartition",type:"radio",value:"true"})," 是"),(0,n.default)("label",{className:"ml20"},void 0,(0,n.default)("input",{name:"isPartition",type:"radio",value:"false",defaultChecked:!0})," 否"))),S=(0,n.default)("div",{name:"isVisible",className:"form-group col-md-3"},void 0,(0,n.default)("label",{htmlFor:"isVisible"},void 0,"可见性 : "),(0,n.default)("div",{className:"radio"},void 0,(0,n.default)("label",{},void 0,(0,n.default)("input",{name:"isVisible",type:"radio",value:"PUBLIC",defaultChecked:!0})," 共享"),(0,n.default)("label",{className:"ml20"},void 0,(0,n.default)("input",{name:"isVisible",type:"radio",value:"PRIVATE"})," 私有"))),P=(0,n.default)("label",{},void 0,(0,n.default)("span",{className:"identify"},void 0,"* "),"分片数 : "),V=(0,n.default)("span",{className:"messages"}),J=(0,n.default)("label",{},void 0,(0,n.default)("span",{className:"identify"},void 0,"* "),"副本数 : "),M=(0,n.default)("span",{className:"messages"}),L=(0,n.default)("div",{className:"box-header with-border "},void 0,(0,n.default)("p",{className:"box-title"},void 0,"字段 ",(0,n.default)("small",{},void 0," （下划线不能放在字段名首尾 且 同级字段名不能相同）"))),X=(0,n.default)("thead",{},void 0,(0,n.default)("tr",{},void 0,(0,n.default)("th",{}),(0,n.default)("th",{},void 0,"字段名"),(0,n.default)("th",{},void 0,"字段描述"),(0,n.default)("th",{},void 0,"字段类型"),(0,n.default)("th",{},void 0,"存储"),(0,n.default)("th",{},void 0,"索引"),(0,n.default)("th",{},void 0,"分词"),(0,n.default)("th",{},void 0,"主键"),(0,n.default)("th",{},void 0,"操作"))),B=(0,n.default)("div",{className:"box-header with-border"},void 0,(0,n.default)("p",{className:"box-title"},void 0,"设置分区 ",(0,n.default)("small",{},void 0," （新建字段需包含 [date] 类型且字段名不为空）"))),G=(0,n.default)("label",{htmlFor:"partitionField"},void 0,"分区字段"),U=(0,n.default)("span",{className:"messages"}),Z=(0,n.default)("label",{htmlFor:"partitionRule"},void 0,"分区规则"),j=(0,n.default)("span",{className:"messages"}),W=(0,n.default)("select",{id:"partitionRuleSelect",className:"form-control ml5 left"},void 0,(0,n.default)("option",{value:"d",selected:!0},void 0,"天"),(0,n.default)("option",{value:"w"},void 0,"周"),(0,n.default)("option",{value:"M"},void 0,"月"),(0,n.default)("option",{value:"y"},void 0,"年")),K=(0,n.default)("i",{className:"fa fa-save"}),Q=function(e){function a(e){(0,u.default)(this,a);var t=(0,v.default)(this,(a.__proto__||(0,o.default)(a)).call(this,e));return t.isNameExistsHandler=t.isNameExistsHandler.bind(t),t.createDataSetHandler=t.createDataSetHandler.bind(t),t.changePartitionRangeHandler=t.changePartitionRangeHandler.bind(t),t.selectIndexHandler=t.selectIndexHandler.bind(t),t.selectTypeHandler=t.selectTypeHandler.bind(t),t.shardJudge=t.shardJudge.bind(t),t.replicationJudge=t.replicationJudge.bind(t),t.partitionRuleJudge=t.partitionRuleJudge.bind(t),t.validateHandler=t.validateHandler.bind(t),t.showPartitionRangeHandler=t.showPartitionRangeHandler.bind(t),t.partitionRuleHandler=t.partitionRuleHandler.bind(t),t.fieldInputHandler=t.fieldInputHandler.bind(t),t.focusVal=t.focusVal.bind(t),t.schemaValidate=t.schemaValidate.bind(t),t.isExistNameChange=t.isExistNameChange.bind(t),t}return(0,g.default)(a,e),(0,p.default)(a,[{key:"componentWillMount",value:function(){this.props.getMaxSettingNums(),this.props.listAnalyzers()}},{key:"componentDidMount",value:function(){k={},this.crateTableHandler(),(0,N.default)('input[ type = "radio"]');for(var e in this.props.dataset.dateFields)delete this.props.dataset.dateFields[e];$('div[name = "partitionArea"]').hide(),this.showPartitionRangeHandler()}},{key:"componentDidUpdate",value:function(){for(var e="",a=0;a<this.props.dataset.analyzers.length;a++)e+='<option value="'+this.props.dataset.analyzers[a]+'">'+this.props.dataset.analyzers[a]+"</option>";H='<select name="analyzer" class="form-control" id="analyzer">'+e+"</select>",$("#shard").val()||$("#shard").val(this.props.dataset.maxSettingNums.maxShardNum)}},{key:"showPartitionRangeHandler",value:function(){$('input[name="isPartition"]').on("ifChanged",function(){"true"==$(this).val()?$('div[name = "partitionArea"]').show():($("#partitionRule",$("#datasetAdd")).val(""),$('div[name = "partitionArea"]').hide())})}},{key:"changePartitionRangeHandler",value:function(e){var a=$(e.currentTarget).val();"date"===a?($('select[name = "dateRange"]').removeClass("hide"),$('span[name = "numRange"]').addClass("hide")):"number"===a&&($('select[name = "dateRange"]').addClass("hide"),$('span[name = "numRange"]').removeClass("hide"))}},{key:"crateTableHandler",value:function(){var e=this,a={};a.id="schema",a.columns=[{className:"textCenter",orderable:!1,data:null,defaultContent:""},{data:"fieldName",orderable:!1},{data:"name",orderable:!1},{data:"type",orderable:!1},{data:"store",orderable:!1},{data:"index",orderable:!1},{data:"analyzer",orderable:!1},{data:"key",orderable:!1},{className:"",orderable:!1,data:null,defaultContent:""}],a.dom='<"top">rt<"bottom"i>',a.scrollX=!1,a.paging=!1,a.createdRow=function(e,a,t){$("td:eq(0)",e).html("<span class='row-details row-details-close mt10 hide'></span><i class='fa fa-circle-thin mt10'></i>"),$("td:eq(8)",e).html("<i class='fa fa-trash-o' style='cursor: pointer;' title='删除'></i>")},a.data=[];var t=(0,x.default)(a);$("#schema").on("click","tbody td .fa-trash-o",function(){var a=$(this).parents("tr"),l=$(this).closest("tr").find("input.fieldName").val().trim(),i=t.row(a);i.remove(),t.draw(),"date"==$(this).closest("tr").find('select[name = "type"]').val()&&delete k[l],e.props.setDateField(k);for(var n=[],s=0;s<$('select[name = "type"]').length;s++)n.push($('select[name = "type"]').eq(s).val());n.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}),$("#schema").on("click","tbody td .row-details",function(){var a=$(this).parents("tr"),l=t.row(a);if(l.child.isShown()){for(var i=0;i<$("input.fieldName").length;i++)if(!/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/.test($("input.fieldName",$(a.next())).eq(i).val()))return void $("input.fieldName",$(a.next())).eq(i).blur();$(this).addClass("row-details-close").removeClass("row-details-open");for(var n=l.child().find("tbody tr"),s=[],r=0;r<$(n).length;r++){var o=$(n)[r];if(0!=$("input.fieldName",$(o)).length){var c={};c.fieldName=$("input.fieldName",$(o)).val(),c.name=$("input.name",$(o)).val();var u=$('select[name = "type"]',$(o)).val();c.type=u,"date"===u&&(c.format="yyyy-MM-dd HH:mm:ss"),c.store=$('select[name = "store"]',$(o)).val();var m=$('select[name = "index"]',$(o)).val(),p=$('select[name = "analyzer"]',$(o)).val();0!=$("input.fieldName",$(o)).length&&("false"==m?c.index="no":"string"!=u?c.index="not_analyzed":"string"==u&&"not_analyzed"==p?c.index="not_analyzed":"string"==u&&"not_analyzed"!=p&&(c.index="analyzed",c.analyzer=p)),c.key=$('select[name = "key"]',$(o)).val(),s.push(c)}}a.attr("schema",(0,d.default)(s)),l.child.hide()}else{if($(this).addClass("row-details-open").removeClass("row-details-close"),l.child())return void l.child.show();l.child('<div id="nestRow_'+l.index()+'"><button type="submit" name="createNested" class="btn btn-sm btn-default mb5">\n                                <i class="fa fa-fw fa-plus-circle"></i>\n                                添加子字段\n                           </button>\n                           <table id="nestTable_'+l.index()+'"  class="table table-bordered" width="100%">\n                           <thead>\n                               <tr>\n                                   <th>子字段名</th>\n                                   <th>子字段描述</th>\n                                   <th>子字段类型</th>\n                                   <th>存储</th>\n                                   <th>索引</th>\n                                   <th>分词</th>\n                                   <th>主键</th>\n                                   <th>操作</th>\n                               </tr>\n                           </thead>\n                        </table></div>').show();var f={};f.id="nestTable_"+l.index(),f.columns=[{data:"fieldName",orderable:!1},{data:"name",orderable:!1},{data:"type",orderable:!1},{data:"store",orderable:!1},{data:"index",orderable:!1},{data:"analyzer",orderable:!1},{data:"key",orderable:!1},{className:"",orderable:!1,data:null,defaultContent:""}],f.createdRow=function(e,a,t){$("td:eq(7)",e).html("<i class='fa fa-trash-o' style='cursor: pointer;' title='删除'></i>")},f.paging=!1,f.dom='<"top">rt<"bottom"i>',f.scrollX=!1,f.data=[];var v=(0,x.default)(f);$("#nestTable_"+l.index()).on("click","tbody td .fa-trash-o",function(){var a=$(this).parents("tr"),t=v.row(a);t.remove(),v.draw();var l=$(this).closest("tr").find("input.fieldName").val().trim();"date"==$(this).closest("tr").find('select[name = "type"]').val()&&delete k[l],e.props.setDateField(k);for(var i=[],n=0;n<$('select[name = "type"]').length;n++)i.push($('select[name = "type"]').eq(n).val());i.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}),$('button[name = "createNested"]',$("#nestRow_"+l.index())).off("click").on("click",function(){var a=$("#nestTable_"+l.index()).DataTable();a.row.add({data:"",fieldName:'<div class="fieldNameDiv form-group"><input type="text" placeholder="支持英文、数字、下划线" name="fieldName" maxlength= "30" class="fieldName form-control"><span class="messages"></span></div>',name:'<input type="text" class="name form-control">',type:'<select name="type" class="form-control"><option value="string">string</option><option value="long">long</option><option value="double">double</option><option value="date">date</option><option value="geo_point">geo_point</option></select>',store:'<select name="store" class="form-control"><option value="true">是</option><option value="false" selected>否</option></select>',index:'<select name="index" class="form-control"><option value="true">是</option><option value="false">否</option></select>',analyzer:H,key:'<select class="form-control"  name="key" id="key"><option value="true">是</option><option value="false" selected>否</option></select>'}).draw(),$("input.fieldName",$("#nestTable_"+l.index())).focus(function(e){""!=$(e.currentTarget).val().trim()&&(R=$(e.currentTarget).val().trim())}),$("input.fieldName",$("#nestTable_"+l.index())).blur(function(e){var a={fieldName:{presence:{message:"请输入字段名(同级字段不能重名)"},format:{pattern:"^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$",message:"请输入合法字段名"}}};(0,w.baseValidate)($(e.currentTarget).closest($(".fieldNameDiv")),a)}),$("input.fieldName",$("#nestTable_"+l.index())).change(function(a){var t=$(a.currentTarget).val().trim(),i=$(a.currentTarget).closest("tr").find('select[name="type"]').val(),n=[];return $("input.fieldName",$("#nestTable_"+l.index())).not($(a.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&n.push($(a).val())}),n.indexOf(t)!=-1?($(a.currentTarget).val(""),void $(a.currentTarget).focus()):($("input.fieldName",$("#nestTable_"+l.index())).each(function(){n.push($(this).val())}),""==t?delete k[R]:"date"==i&&(delete k[R],k[t]=t),void e.props.setDateField(k))}),$('select[name = "type"]',$("#nestTable_"+l.index())).change(function(){"string"===$(this).val()&&"true"==$(this).closest("tr").find('select[name = "index"]').val()?$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0);var a=$(this).val(),t=$(this).closest("tr").find("input.fieldName").val().trim();"date"===a&&""!=t?k[t]=t:delete k[t],e.props.setDateField(k);for(var l=[],i=0;i<$('select[name = "type"]').length;i++)l.push($('select[name = "type"]').eq(i).val());l.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}),$('select[name = "index"]',$("#nestTable_"+l.index())).change(function(){"true"===$(this).val()&&"string"==$(this).closest("tr").find('select[name = "type"]').val()?$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)})})}})}},{key:"isNameExistsHandler",value:function(){var e={datasetName:{presence:{message:"请输入数据集名"},format:{pattern:"^(?!_)(?!.*?_$)[a-z0-9_]+$",message:"不能为空，命名格式为小写英文字母和数字组成、除下划线外不能包含特殊字符，下划线不能出现在开头和结尾"},length:{maximum:30,message:"不能超过30个字符"}}};if((0,w.baseValidate)($(".datasetNameDiv"),e),""!=$("#datasetName",$("#datasetAdd")).val().trim()){var a=this.props.dataset.isExists;if(a){var t={datasetName:{format:{pattern:"!^(?!_)(?!.*?_$)[a-z0-9_]+$",message:"数据集名已存在, 请重新输入 !"}}};return void(0,w.baseValidate)($(".datasetNameDiv"),t)}}}},{key:"isExistNameChange",value:function(){""!=$("#datasetName",$("#datasetAdd")).val().trim()&&this.props.isExists($("#datasetName",$("#datasetAdd")).val())}},{key:"shardJudge",value:function(e){var a={shard:{presence:{message:"请输入分片数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,lessThanOrEqualTo:parseInt(e.target.max,10),notGreaterThanOrEqualTo:"最小值应大于等于 1",notLessThanOrEqualTo:"最大值应小于等于 "+e.target.max}}};(0,w.baseValidate)($(".shardJudgeDiv"),a)}},{key:"replicationJudge",value:function(e){var a={replication:{presence:{message:"请输入副本数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:0,lessThanOrEqualTo:parseInt(e.target.max,10),notGreaterThanOrEqualTo:"最小值为 0",notLessThanOrEqualTo:"最大值应小于等于 "+e.target.max}}};(0,w.baseValidate)($(".replicationJudgeDiv"),a)}},{key:"partitionRuleJudge",value:function(e){var a={partitionRule:{presence:"true"==$('input[name="isPartition"]:checked').val()&&{message:"请输入分区规则数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,notGreaterThanOrEqualTo:"最小值为 1",lessThanOrEqualTo:1024,notLessThanOrEqualTo:"最大值不能超过 1024"}}};(0,w.baseValidate)($("#partitionRuleDiv"),a)}},{key:"validateHandler",value:function(){var e={datasetName:{presence:{message:"请输入数据集名"},format:{pattern:"^(?!_)(?!.*?_$)[a-z0-9_]+$",message:"请输入正确的数据集名"}},shard:{presence:{message:"请输入分片数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,lessThanOrEqualTo:this.props.dataset.maxSettingNums.maxShardNum,notGreaterThanOrEqualTo:"最小值应大于等于 1",notLessThanOrEqualTo:"最大值应小于等于 "+this.props.dataset.maxSettingNums.maxShardNum}},replication:{presence:{message:"请输入副本数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:0,lessThanOrEqualTo:this.props.dataset.maxSettingNums.maxReplicationNum,notGreaterThanOrEqualTo:"最小值为 0",notLessThanOrEqualTo:"最大值为 "+this.props.dataset.maxSettingNums.maxReplicationNum}},partitionRule:{presence:"true"==$('input[name="isPartition"]:checked').val()&&{message:"请输入分区规则数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,notGreaterThanOrEqualTo:"最小值为 1",lessThanOrEqualTo:1024,notLessThanOrEqualTo:"最大值不能超过 1024"}}};(0,w.baseValidate)($("#datasetAdd"),e)}},{key:"schemaValidate",value:function(e){var a={fieldName:{presence:{message:"请输入字段名(同级字段不能重名)"},format:{pattern:"^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$",message:"请输入合法字段名"}}};(0,w.baseValidate)($(e.currentTarget).closest($(".fieldNameDiv")),a)}},{key:"createDataSetHandler",value:function(){var e=this;if(0==$("input.fieldName").length){if("true"==$('input[name = "isPartition"]:checked',$("#datasetAdd")).val())return void(0,_.error)("没有字段不能设置分区！")}else for(var a=0;a<$("input.fieldName").length;a++)if(""==$("input.fieldName").eq(a).val())return void $("input.fieldName").eq(a).blur();if(this.validateHandler(),!($("span.messages").find("p").length>0)){if("true"==$('input[name = "isPartition"]:checked',$("#datasetAdd")).val()&&""==$("#partitionField",$("#datasetAdd")).val())return void(0,_.error)("请选择分区字段！");if("true"==$('input[name = "isPartition"]:checked',$("#datasetAdd")).val()&&""==$("#partitionRule",$("#datasetAdd")).val().trim())return void this.validateHandler();var t={};if(t.datasetName=$("#datasetName",$("#datasetAdd")).val(),t.isPartition=$('input[name = "isPartition"]:checked',$("#datasetAdd")).val(),"true"==t.isPartition&&(t.partitionField=$("#partitionField",$("#datasetAdd")).val(),t.partitionRule=$("#partitionRule",$("#datasetAdd")).val()+$("#partitionRuleSelect",$("#datasetAdd")).val()),t.visable=$('input[name = "isVisible"]:checked',$("#datasetAdd")).val(),t.shard=$("#shard",$("#datasetAdd")).val(),t.replication=$("#replication",$("#datasetAdd")).val(),t.schema={},t.owner=sessionStorage.getItem("XDataUserName"),t.schema.properties=[],$("span.row-details-open",$("#schema")).click(),0!=$("input.fieldName",$("#schema")).length)for(var l=0;l<$("tbody tr",$("#schema")).length;l++){var i=$("tbody tr",$("#schema"))[l],n=$('select[name = "index"]',$(i)).val(),s=$('select[name = "type"]',$(i)).val(),d=$('select[name = "analyzer"]',$(i)).val(),r={};r.fieldName=$("input.fieldName",$(i)).val(),r.name=$("input.name",$(i)).val(),r.type=s,"date"===s&&(r.format="yyyy-MM-dd HH:mm:ss"),"nested"===s?r.schema=$(i).attr("schema")?JSON.parse($(i).attr("schema")):[]:(r.store=$('select[name = "store"]',$(i)).val(),r.key=$('select[name = "key"]',$(i)).val(),0!=$("input.fieldName",$(i)).length&&("false"==n?r.index="no":"string"!=s?r.index="not_analyzed":"string"==s&&"not_analyzed"==d?r.index="not_analyzed":"string"==s&&"not_analyzed"!=d&&(r.index="analyzed",r.analyzer=d))),t.schema.properties.push(r)}this.props.createDataset(t),"0"==this.props.dataset.code.code&&setTimeout(function(){e.props.history.replace("/dataSet")},500)}}},{key:"handleCreateHandler",value:function(){var e=$("#schema").DataTable();e.row.add({data:"",fieldName:'<div class="fieldNameDiv form-group"><input type="text" name="fieldName" placeholder="支持英文、数字、下划线" maxlength= "30" class="fieldName fieldNamer form-control"><span class="messages"></span></div>',name:'<input type="text" class="name form-control">',type:E,store:z,index:D,analyzer:H,key:q}).draw(),$("input.fieldName",$("#schema")).focus(this.focusVal),$("input.fieldName",$("#schema")).blur(this.fieldInputHandler),$('select[name = "type"]',$("#schema")).change(this.selectTypeHandler),$('select[name = "index"]',$("#schema")).change(this.selectIndexHandler)}},{key:"focusVal",value:function(e){""!=$(e.currentTarget).val().trim()&&(R=$(e.currentTarget).val().trim())}},{key:"fieldInputHandler",value:function(e){var a=$(e.currentTarget).val().trim(),t=$(e.currentTarget).closest("tr").find('select[name="type"]').val(),l=[];return this.schemaValidate(e),$("input.fieldNamer").not($(e.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&l.push($(a).val())}),l.indexOf(a)!=-1?($(e.currentTarget).val(""),void $(e.currentTarget).blur()):""==a?(delete k[R],void this.props.setDateField(k)):void("date"==t&&(delete k[R],k[a]=a,this.props.setDateField(k)))}},{key:"selectIndexHandler",value:function(e){var a=$(e.currentTarget).val();"true"===a&&"string"==$(e.currentTarget).closest("tr").find('select[name = "type"]').val()?$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)}},{key:"selectTypeHandler",value:function(e){var a=$(e.currentTarget).val(),t=$(e.currentTarget).closest("tr").find("input.fieldName").val().trim();if("nested"===a)$(e.currentTarget).closest("tr").find("span.row-details-close").click(),$("span.row-details",$(e.currentTarget).closest("tr")).removeClass("hide"),$("i.fa-circle-thin",$(e.currentTarget).closest("tr")).addClass("hide"),$(e.currentTarget).closest("tr").find('select[name = "store"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "index"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "key"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0),delete k[t];else{var l=$("#schema").DataTable(),i=$(e.currentTarget).parents("tr"),n=l.row(i);n.child.isShown()&&($("tbody td .fa-trash-o",$("#nestTable_"+n.index())).click(),$(e.currentTarget).closest("tr").find("span.row-details-open").addClass("row-details-close").removeClass("row-details-open"),n.child.remove()),$("span.row-details",$(e.currentTarget).closest("tr")).addClass("hide"),$("i.fa-circle-thin",$(e.currentTarget).closest("tr")).removeClass("hide"),$(e.currentTarget).closest("tr").find('select[name = "store"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "index"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "key"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1),"date"===a&&""!=t?k[t]=t:delete k[t],this.props.setDateField(k),"string"===a&&"true"==$(e.currentTarget).closest("tr").find('select[name = "index"]').val()?$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)}for(var s=[],d=0;d<$('select[name = "type"]').length;d++)s.push($('select[name = "type"]').eq(d).val());s.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}},{key:"partitionRuleHandler",value:function(){for(var e=0;e<$("input.fieldName").length;e++){var a=$("input.fieldName").eq(e).val().trim(),t=$("input.fieldName").eq(e).closest("tr").find('select[name="type"]').val();""!=a&&"date"==t&&(k[a]=a,this.props.setDateField(k))}}},{key:"render",value:function(){var e=[C];for(var a in this.props.dataset.dateFields)e.push((0,n.default)("option",{value:a},void 0,this.props.dataset.dateFields[a]));return(0,n.default)("div",{id:"datasetAdd"},void 0,(0,n.default)("div",{className:"box box-primary"},void 0,A,(0,n.default)("div",{className:"box-body"},void 0,(0,n.default)("div",{className:"row"},void 0,(0,n.default)("div",{className:"datasetNameDiv col-md-6 form-group"},void 0,O,F,(0,n.default)("input",{type:"text",id:"datasetName",maxLength:30,name:"datasetName",className:"form-control",placeholder:"30个字符以内，只允许含有小写英文、数字和下划线且下划线不能放首尾",onChange:this.isExistNameChange,onBlur:this.isNameExistsHandler})),I,S),(0,n.default)("div",{className:"row"},void 0,(0,n.default)("div",{className:"shardJudgeDiv col-md-6 form-group"},void 0,P,V,(0,n.default)("input",{type:"text",name:"shard",id:"shard",min:"1",onBlur:this.shardJudge,max:this.props.dataset.maxSettingNums.maxShardNum,className:"form-control",placeholder:"1 <= 分片数 <= "+this.props.dataset.maxSettingNums.maxShardNum})),(0,n.default)("div",{className:"replicationJudgeDiv col-md-6 form-group"},void 0,J,M,(0,n.default)("input",{type:"text",name:"replication",id:"replication",onBlur:this.replicationJudge,min:"0",max:this.props.dataset.maxSettingNums.maxReplicationNum,defaultValue:1,className:"form-control",placeholder:"0 <= 副本数 <= "+this.props.dataset.maxSettingNums.maxReplicationNum}))))),(0,n.default)("div",{className:"box box-primary"},void 0,L,(0,n.default)("div",{className:"row box-body"},void 0,(0,n.default)("div",{className:"col-md-12"},void 0,(0,n.default)("div",{className:"box-header pull-left"},void 0,(0,n.default)("button",{type:"submit",name:"createDataset",className:"btn btn-primary",onClick:this.handleCreateHandler.bind(this)},void 0,(0,n.default)("i",{className:"fa fa-fw fa-plus-circle",style:{verticalAlign:"middle",padding:"0 8px 0 0"}}),"添加字段")),(0,n.default)("div",{className:"box-body"},void 0,(0,n.default)("table",{id:"schema",className:"table table-striped table-bordered",style:{width:"100%"}},void 0,X))))),(0,n.default)("div",{name:"partitionArea",id:"partitionArea",className:"box box-primary"},void 0,B,(0,n.default)("div",{className:"partition box-body"},void 0,(0,n.default)("div",{className:"partitionDetails row"},void 0,(0,n.default)("div",{className:"form-group col-md-6"},void 0,G,U,(0,n.default)("select",{onMouseEnter:this.partitionRuleHandler,name:"partitionField",id:"partitionField",disabled:!0,className:"form-control",style:{width:"100%"}},void 0,e)),(0,n.default)("div",{className:"col-md-6 row"},void 0,(0,n.default)("div",{id:"partitionRuleDiv",className:"form-group col-md-6",style:{width:"86%"}},void 0,Z,j,(0,n.default)("div",{},void 0,(0,n.default)("input",{type:"text",onBlur:this.partitionRuleJudge,id:"partitionRule",name:"partitionRule",min:"1",className:"distanceNum form-control left"}))),(0,n.default)("div",{className:"col-md-6",style:{width:"13%",marginTop:"25px"}},void 0,W))))),(0,n.default)("button",{name:"saveBtn",className:"btn btn-primary",onClick:this.createDataSetHandler},void 0,K," 保存"))}}]),a}(b.Component);a.default=Q}});