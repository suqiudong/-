webpackJsonp([2,51],{11:function(e,a){"use strict";function t(e){var a=e.hasOwnProperty("class")?$("."+e.class):$("#"+e.id);a.select2({placeholder:e.placeholder||"请选择",data:e.data||[],multiple:e.multiple||!1,language:e.language||"zh-CN",tags:e.tags||!1,minimumResultsForSearch:e.minimumResultsForSearch||"Infinity",val:e.val})}function l(e,a,t){var l="string"==typeof e?$("#"+e):$("."+e.class);l.off(a).on(a,t)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t,a.bindSelectEvent=l},13:function(e,a){"use strict";function t(e){$(e).iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",disabledClass:"disabled"})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t},423:function(e,a,t){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var i=t(5),s=l(i),d=t(6),r=l(d),o=t(3),n=l(o),c=t(4),p=l(c),v=t(8),u=l(v),m=t(7),h=l(m),f=t(2),g=l(f),y=t(147),_=l(y),b=t(11),N=l(b),k=t(13),x=l(k),A=t(10),R=(0,s.default)("p",{className:"box-header with-border sp_role_info"},void 0,(0,s.default)("h4",{},void 0,"权限管理")),S=(0,s.default)("div",{className:"col-sm-2 hidden-xs text-right"},void 0,(0,s.default)("p",{className:"sp_role"},void 0,"选择角色 : "),(0,s.default)("p",{className:"sp_role_set"},void 0,"角色权限设置 : ")),E=(0,s.default)("li",{role:"presentation",className:"active"},void 0,(0,s.default)("a",{className:"sp_presentation",href:"#home",role:"tab","data-toggle":"tab"},void 0,"系统权限管理")),O=(0,s.default)("i",{className:"fa fa-check"}),P=(0,s.default)("i",{className:"fa fa-remove"}),C=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_pluginsystem"},void 0,"插件权限: "),D=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_users"},void 0,"用户权限: "),T=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_roles"},void 0,"角色权限: "),w=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_dateset"},void 0,"数据集权限: "),H=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_report"},void 0,"报表权限: "),B=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_dashboard"},void 0,"仪表板权限: "),L=(0,s.default)("div",{className:"col-xs-2 sp_classify_name text-right sp_jobsystem"},void 0,"作业权限: "),U=function(e){function a(e){(0,n.default)(this,a);var t=(0,u.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.createSelect=t.createSelect.bind(t),t.handleChange=t.handleChange.bind(t),t.privilege=t.privilege.bind(t),t.handleModify=t.handleModify.bind(t),t.modelContent=t.modelContent.bind(t),t.checkAllHandler=t.checkAllHandler.bind(t),t.uncheckAllHandler=t.uncheckAllHandler.bind(t),t}return(0,h.default)(a,e),(0,p.default)(a,[{key:"componentWillMount",value:function(){this.props.readPrivilege(),this.props.getSysPrivilege()}},{key:"componentDidMount",value:function(){if(this.props.params.id)this.handleEdit();else{this.handleChange();for(var e=[],a=this.props.systemPrivilege.systemPrivilegeData.result.data,t=0;t<a.length;t++){var l={};l.id=a[t].roleName,l.text=a[t].roleName,e.push(l)}this.createSelect(e)}}},{key:"createSelect",value:function(e){var a={};a.id="select_role",a.data=e,a.tags=!1,a.placeholder="输入角色名快速查找",a.minimumResultsForSearch=2,(0,N.default)(a),(0,b.bindSelectEvent)("select_role","select2:select",this.handleChange)}},{key:"handleChange",value:function(){this.props.readPrivilege(),$(".checkAll").addClass("hide"),$(".cancelCheck").addClass("hide"),$(".sp_select_role").attr("disabled",!1);for(var e=this.props.systemPrivilege.systemPrivilegeData.result.data,a=$(".sp_detail"),t=$(".sp_select_role").val(),l=0;l<e.length;l++)if(e[l].roleName==t){var i=function(t){a.each(function(a,i){i.name==t&&($.inArray($(i).attr("data-name"),e[l].privilege[t])!=-1?($(i).parents("label").css("color","#000"),i.checked=!0,(0,x.default)(i)):($(i).parents("label").css("color","#d2d6de"),i.checked=!1,(0,x.default)(i))),i.disabled=!0,(0,x.default)(i)})};for(var s in e[l].privilege)i(s)}$(".modify").attr("disabled",!1),$(".cancel").attr("disabled",!0),$(".ensure").attr("disabled",!0)}},{key:"handleEdit",value:function(e){$(".ensure").attr("disabled",!1),$(".modify").attr("disabled",!0),$(".cancel").attr("disabled",!1),$(".checkAll").removeClass("hide"),$(".cancelCheck").removeClass("hide"),$(".sp_select_role").attr("disabled",!0);var a=$(".sp_detail");a.each(function(e,a){$(a).parents("label").css("color","#000"),a.disabled=!1,(0,x.default)(a)})}},{key:"handleModify",value:function(){var e=$(".sp_select_role").val(),a=$(".sp_detail"),t=[],l={};l.roleName=e,l.privilege={},l.privilege.USER=[],l.privilege.REPORT=[],l.privilege.ROLE=[],l.privilege.DATASET=[],l.privilege.DASHBOARD=[],l.privilege.JOB=[],l.privilege.PLUGIN=[],a.each(function(e,a){a.checked&&("USER"==a.name&&l.privilege.USER.push($(a).attr("data-name")),"REPORT"==a.name&&l.privilege.REPORT.push($(a).attr("data-name")),"ROLE"==a.name&&l.privilege.ROLE.push($(a).attr("data-name")),"DATASET"==a.name&&l.privilege.DATASET.push($(a).attr("data-name")),"DASHBOARD"==a.name&&l.privilege.DASHBOARD.push($(a).attr("data-name")),"JOB"==a.name&&l.privilege.JOB.push($(a).attr("data-name")),"PLUGIN"==a.name&&l.privilege.PLUGIN.push($(a).attr("data-name")))}),t.push(l),this.props.checkSysPrivilege(t);var i=this.props.systemPrivilege.checkSysPrivilege,s=i.result.detail.add,d=i.result.detail.remove;if("0"!=i.code)return void(0,A.error)(i.msg);var r="";if(0!=s.length||0!=d.length){for(var o=0;o<s.length;o++)r="<li>因 <mark>"+s[o].dependency+"</mark> 权限添加, 其依赖权限影响的 <u> "+s[o].privileges+" </u> 权限将被 <strong>自动添加</strong> ;</li>",$("#dependency").append(r);for(var n=0;n<d.length;n++)r="<li>因 <mark>"+d[n].dependency+"</mark> 权限移除, 其依赖权限影响的 <u>"+d[n].privileges+"</u> 权限将被 <strong>自动移除</strong> ;</li>",$("#dependency").append(r)}}},{key:"modelContent",value:function(){var e=$(".sp_select_role").val(),a=(0,s.default)("ol",{id:"dependency",className:"todo-list ui-sortable"},void 0,(0,s.default)("li",{},void 0,"您确定要修改角色： ",(0,s.default)("strong",{},void 0,e)," 的系统权限吗？"));$("#dependency").html(""),this.refs.sp_modify.setContent(a)}},{key:"modifyOKHandle",value:function(){$(".sp_select_role").attr("disabled",!1);var e=$(".sp_select_role").val(),a=$(".sp_detail"),t={};t.roleName=e,t.privilege={},t.privilege.USER=[],t.privilege.REPORT=[],t.privilege.ROLE=[],t.privilege.DATASET=[],t.privilege.DASHBOARD=[],t.privilege.JOB=[],t.privilege.PLUGIN=[],a.each(function(e,a){a.checked?("USER"==a.name&&t.privilege.USER.push($(a).attr("data-name")),"REPORT"==a.name&&t.privilege.REPORT.push($(a).attr("data-name")),"ROLE"==a.name&&t.privilege.ROLE.push($(a).attr("data-name")),"DATASET"==a.name&&t.privilege.DATASET.push($(a).attr("data-name")),"DASHBOARD"==a.name&&t.privilege.DASHBOARD.push($(a).attr("data-name")),"JOB"==a.name&&t.privilege.JOB.push($(a).attr("data-name")),"PLUGIN"==a.name&&t.privilege.PLUGIN.push($(a).attr("data-name"))):$(a).parents("label").css("color","#d2d6de"),a.disabled=!0,(0,x.default)(a)}),this.props.modifyPrivilege(t),$(".ensure").attr("disabled",!0),$(".cancel").attr("disabled",!0),$(".modify").attr("disabled",!1),$("#sp_modify").modal("hide"),this.props.params.id?this.props.history.replace("/roleManage"):this.props.history.replace("/systemPrivilege")}},{key:"privilege",value:function(e,a){var t=e[a].map(function(e){return(0,s.default)("label",{className:"col-xs-3 col-sm-2 sp_label"},void 0," ",(0,s.default)("input",{className:"sp_roles_detail sp_detail",name:a,"data-Name":e,type:"checkbox"})," ",(0,s.default)("span",{},void 0," ",e," ")," ")});return t}},{key:"checkAllHandler",value:function(){$('#home .row.sp_classify input[type="checkbox"]').iCheck("check")}},{key:"uncheckAllHandler",value:function(){$('#home .row.sp_classify input[type="checkbox"]').iCheck("uncheck")}},{key:"render",value:function(){var e=void 0,a=void 0,t=void 0,l=void 0,i=void 0,d=void 0,r=void 0,o=this.props.systemPrivilege.getSysPrivilege.result.detail;for(var n in o)for(var c=0;c<o[n].length;c++)"USER"==n?e=this.privilege(o,n):"REPORT"==n?a=this.privilege(o,n):"ROLE"==n?t=this.privilege(o,n):"DATASET"==n?l=this.privilege(o,n):"DASHBOARD"==n?i=this.privilege(o,n):"JOB"==n?d=this.privilege(o,n):"PLUGIN"==n&&(r=this.privilege(o,n));var p=this.props.systemPrivilege.systemPrivilegeData.result.data[0].roleName,v=(0,s.default)("button",{type:"button",className:"cancel btn btn-primary sp_btn",onClick:this.handleChange},void 0,"取消");return this.props.params.id&&(p=this.props.params.id,v=""),(0,s.default)("div",{className:"box box-primary"},void 0,R,(0,s.default)("div",{className:"row sp_content"},void 0,S,(0,s.default)("div",{className:"col-sm-8 col-xs-12"},void 0,(0,s.default)("div",{className:"sp_select_role_div"},void 0,(0,s.default)("select",{className:"sp_select_role form-control",name:"",id:"select_role"},void 0,(0,s.default)("option",{value:p},void 0,p))),(0,s.default)("div",{className:"nav-tabs-custom",style:{userSelect:"none"}},void 0,(0,s.default)("ul",{className:"nav nav-tabs",role:"tablist"},void 0,E,(0,s.default)("li",{className:"pull-right header"},void 0,(0,s.default)("button",{type:"submit",className:"modify btn btn-primary margin",onClick:this.handleEdit.bind(this)},void 0,"修改"),(0,s.default)("button",{type:"submit",className:"checkAll btn btn-primary margin hide",onClick:this.checkAllHandler.bind(this)},void 0,O," 全选"),(0,s.default)("button",{type:"submit",className:"cancelCheck btn btn-primary hide",onClick:this.uncheckAllHandler.bind(this)},void 0,P," 清除"))),(0,s.default)("div",{className:"tab-content"},void 0,(0,s.default)("div",{user:"tabpanel",className:"tab-pane active",id:"home"},void 0,(0,s.default)("div",{className:"row sp_classify"},void 0,C,(0,s.default)("div",{className:"row col-xs-10 text-center"},void 0,r)),(0,s.default)("div",{className:"row sp_classify"},void 0,D,(0,s.default)("div",{className:"userDiv row col-xs-10 text-center"},void 0,e)),(0,s.default)("div",{className:"row sp_classify"},void 0,T,(0,s.default)("div",{className:"row col-xs-10 text-center"},void 0,t)),(0,s.default)("div",{className:"row sp_classify"},void 0,w,(0,s.default)("div",{className:"row col-xs-10 text-center"},void 0,l)),(0,s.default)("div",{className:"row sp_classify"},void 0,H,(0,s.default)("div",{className:" row col-xs-10 text-center"},void 0,a)),(0,s.default)("div",{className:"row sp_classify"},void 0,B,(0,s.default)("div",{className:" row col-xs-10 text-center"},void 0,i)),(0,s.default)("div",{className:"row sp_classify"},void 0,L,(0,s.default)("div",{className:" row col-xs-10 text-center"},void 0,d))))),(0,s.default)("button",{type:"button",className:"ensure btn btn-primary sp_btn","data-toggle":"modal","data-target":"#sp_modify",onClick:this.modelContent},void 0,"保存"),v)),g.default.createElement(_.default,{modalId:"sp_modify",ref:"sp_modify",title:"修改权限确认",loadModalControlHandler:this.handleModify,okHandler:this.modifyOKHandle.bind(this)}))}}]),a}(f.Component);a.default=U}});