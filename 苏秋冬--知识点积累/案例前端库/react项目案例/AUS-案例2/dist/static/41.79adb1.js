webpackJsonp([41,51],{626:function(e,a,r){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var o=r(5),t=l(o),s=r(17),d=l(s),m=r(16),i=l(m),n=r(6),u=l(n),c=r(3),v=l(c),f=r(4),p=l(f),N=r(8),b=l(N),h=r(7),g=l(h),R=r(2),x=l(R),y=r(149),H={};H.member=[];var k=(0,t.default)("div",{className:"box-header with-border "},void 0,(0,t.default)("p",{className:"box-title"},void 0,"基本信息")),M=(0,t.default)("label",{htmlFor:"roleName"},void 0,(0,t.default)("span",{className:"identify"},void 0,"* "),"角色名 : "),w=(0,t.default)("span",{className:"messages"}),_=(0,t.default)("label",{},void 0,"描述: "),E=(0,t.default)("span",{className:"messages"}),U=(0,t.default)("div",{className:"box-header with-border "},void 0,(0,t.default)("p",{className:"box-title"},void 0,"用戶分配")),T=(0,t.default)("label",{},void 0,"可添加用户"),z=(0,t.default)("i",{className:"fa fa-long-arrow-right col-md-12 dir-right"}),D=(0,t.default)("i",{className:"fa fa-long-arrow-left col-md-12 dir-left"}),P=(0,t.default)("label",{},void 0,"角色内用户"),A=function(e){function a(e){(0,v.default)(this,a);var r=(0,b.default)(this,(a.__proto__||(0,u.default)(a)).call(this,e));return r.addRoleHander=r.addRoleHander.bind(r),r.removeRoleHander=r.removeRoleHander.bind(r),r.saveRoleHander=r.saveRoleHander.bind(r),r.saveRoleToPrivilege=r.saveRoleToPrivilege.bind(r),r.isNameExistsHandler=r.isNameExistsHandler.bind(r),r.allRoleName=r.allRoleName.bind(r),r}return(0,g.default)(a,e),(0,p.default)(a,[{key:"componentWillMount",value:function(){this.props.allUserList(),this.props.readRole()}},{key:"componentDidMount",value:function(){H={},H.member=[],this.props.addUserORRemoveToRole(H)}},{key:"isNameExistsHandler",value:function(){var e=this.allRoleName(),a={roleName:{presence:{message:"请输入角色名"},format:{pattern:"^(?!_)(?!.*?_$)[一-龥a-zA-Z]+[一-龥a-zA-Z0-9-_]*$",message:"请输入正确的角色名"},length:{maximum:20,message:"不能超过20个字符"}}};if((0,y.baseValidate)($(".roleNameDiv"),a),""!=$("#roleName").val().trim()&&e.indexOf($("#roleName").val())!==-1){var r={roleName:{format:{pattern:"!^[一-龥a-zA-Z]+[一-龥a-zA-Z0-9-_]*$",message:"角色名已存在, 请重新输入 !"}}};return void(0,y.baseValidate)($(".roleNameDiv"),r)}}},{key:"allRoleName",value:function(){for(var e=[],a=this.props.roleManage.roleManagesData.result.data,r=0;r<a.length;r++)e.push(a[r].roleName);return e}},{key:"addRoleHander",value:function(e){for(var a=this.props.roleManage.allUserList,r=0;r<a.member.length;r++)"admin"==a.member[r].userName&&a.member.splice(r,1);for(var l=document.querySelector("#select1"),o=[],t=0;t<l.length;t++)l.options[t].selected&&o.push(l[t].index);for(var s=[],d=0;d<a.member.length;d++){for(var m=!0,i=0;i<H.member.length;i++)H.member[i].userName!=a.member[d].userName&&"admin"!=a.member[d].userName||(m=!1);m&&s.push(a.member[d])}for(var n=0;n<o.length;n++)H.member.push(s[o[n]]);o.length>0&&this.props.addUserORRemoveToRole(H)}},{key:"removeRoleHander",value:function(){for(var e=this.props.roleManage.allUserList,a=0;a<e.member.length;a++)"admin"==e.member[a].userName&&e.splice(a,1);for(var r=document.querySelector("#select2"),l=[],o=0;o<r.length;o++)r.options[o].selected&&l.push(r[o].index);l.sort().reverse();for(var t=0;t<l.length;t++)H.member.splice(l[t],1);l.length>0&&this.props.addUserORRemoveToRole(H)}},{key:"saveRoleHander",value:function(){var e=this;if(this.isNameExistsHandler(),!($("span.messages").find("p").length>0)){var a={};a.roleName=$("#roleName").val(),a.desc=$("#desc").val(),a.member=[];for(var r=0;r<H.member.length;r++)a.member.push(H.member[r].userName);(0,i.default)(d.default.mark(function r(){return d.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.props.createRole(a);case 2:0==e.props.roleManage.createRole.code&&e.props.history.replace("/roleManage");case 3:case"end":return r.stop()}},r,e)}))()}}},{key:"saveRoleToPrivilege",value:function(){var e=this;if(this.isNameExistsHandler(),!($("span.messages").find("p").length>0)){var a={};a.roleName=$("#roleName").val(),a.desc=$("#desc").val(),a.member=[];for(var r=0;r<H.member.length;r++)a.member.push(H.member[r].userName);(0,i.default)(d.default.mark(function r(){return d.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.props.createRole(a);case 2:0==e.props.roleManage.createRole.code&&e.props.history.replace("/systemPrivilege/roleSys/"+a.roleName);case 3:case"end":return r.stop()}},r,e)}))()}}},{key:"render",value:function(){var e=void 0,a=void 0;if(void 0!=this.props.roleManage.allUserList.member){for(var r=this.props.roleManage.allUserList.member,l=0;l<r.length;l++)"admin"==r[l].userName&&r.splice(l,1);e=H.member.map(function(e,a){return(0,t.default)("option",{value:e.userName},void 0,e.userName+" ("+e.name+")")});for(var o=[],s=0;s<r.length;s++){for(var d=!0,m=0;m<H.member.length;m++)H.member[m].userName!=r[s].userName&&"admin"!=r[s].userName||(d=!1);d&&o.push(r[s])}a=o.map(function(e,a){return(0,t.default)("option",{value:e.userName},void 0,e.userName+" ("+e.name+")")})}else e=a="";return(0,t.default)("div",{id:"roleAdd"},void 0,(0,t.default)("div",{className:"box box-primary"},void 0,k,(0,t.default)("div",{className:"box-body"},void 0,(0,t.default)("div",{className:"row"},void 0,(0,t.default)("div",{className:"roleNameDiv col-md-6 form-group"},void 0,M,w,(0,t.default)("input",{type:"text",id:"roleName",onBlur:this.isNameExistsHandler,name:"roleName",className:"form-control",placeholder:"角色名唯一且首字母不为下划线"}))),(0,t.default)("div",{className:"row"},void 0,(0,t.default)("div",{className:"descDiv col-md-8 form-group"},void 0,_,E,(0,t.default)("textarea",{style:{maxWidth:"1083px"},placeholder:"添加对该角色的描述",name:"desc",id:"desc",className:"form-control"}))))),(0,t.default)("div",{className:"box box-primary"},void 0,U,(0,t.default)("div",{className:"row"},void 0,(0,t.default)("div",{className:"col-md-12"},void 0,(0,t.default)("div",{className:"box-body"},void 0,(0,t.default)("div",{className:"form-group col-md-4"},void 0,T,x.default.createElement("select",{multiple:"multiple",id:"select1",ref:"select1",className:"form-control",size:"8"},a)),(0,t.default)("div",{className:"col-md-2 dir"},void 0,(0,t.default)("div",{className:"dir-button"},void 0,x.default.createElement("button",{ref:"add",onClick:this.addRoleHander},z),x.default.createElement("button",{ref:"remove",onClick:this.removeRoleHander},D))),(0,t.default)("div",{className:"form-group col-md-4"},void 0,P,x.default.createElement("select",{multiple:"multiple",id:"select2",ref:"select2",className:"form-control",size:"8"},e)))))),x.default.createElement("button",{type:"submit",className:"btn btn-primary",ref:"save",onClick:this.saveRoleHander},"保存"),(0,t.default)("button",{type:"submit",className:"btn btn-primary ml15",onClick:this.saveRoleToPrivilege},void 0,"保存并配置权限"))}}]),a}(R.Component);a.default=A}});