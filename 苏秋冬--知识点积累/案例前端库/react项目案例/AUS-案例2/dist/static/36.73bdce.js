webpackJsonp([36,51],{12:function(e,a){"use strict";function t(e,a){var t={data:e.data||[],destroy:!0,scrollXInner:"100%",dom:e.dom||'<"top"f>rt<"bottom"lip>',columns:e.columns||[],language:{sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 条结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 条结果，共 _TOTAL_ 条",sInfoEmpty:"显示第 0 至 0 条结果，共 0 条",sInfoFiltered:"(由 _MAX_ 条结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},paging:e.paging&&!0,pageLength:e.pageLength||10,columnDefs:e.columnDefs||"",order:e.order||[],createdRow:e.createdRow||null,searching:e.searching&&!0,info:e.info&&!0,ordering:e.ordering&&!0};e.scrollX&&(t.scrollX=e.scrollX);var l=void 0;return l=a?$("#"+e.id).dataTable(t):$("#"+e.id).DataTable(t)}function l(e,a,t,l){$("#"+e+" tbody").off(a,t).on(a,t,l)}function i(e){var a=$("#"+e).DataTable().row($(this).parents("tr")).data();return a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t,a.bindTableEvent=l,a.getTableItem=i},607:function(e,a,t){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var i=t(5),r=l(i),n=t(6),d=l(n),s=t(3),o=l(s),u=t(4),c=l(u),v=t(8),f=l(v),p=t(7),m=l(p),b=t(2),h=l(b),g=t(147),y=l(g),T=t(12),H=l(T),x=t(149),D={},k='<select class="form-control status" name="key"><option value="true">连接</option><option value="false" selected>断开</option></select>',L='<select class="form-control role" name="key"><option value="0">超级管理员</option><option value="1" selected>系统管理员</option><option value="2" selected>普通用户</option></select>',N=(0,r.default)("div",{className:"form-group"},void 0,(0,r.default)("label",{},void 0,(0,r.default)("small",{},void 0,"节点管理 (下划线不能放在节点首尾)"))),A=(0,r.default)("thead",{},void 0,(0,r.default)("tr",{},void 0,(0,r.default)("th",{}),(0,r.default)("th",{},void 0,"节点名"),(0,r.default)("th",{},void 0,"配置状态"),(0,r.default)("th",{},void 0,"管理IP"),(0,r.default)("th",{},void 0,"机柜位置"),(0,r.default)("th",{},void 0,"角色"),(0,r.default)("th",{},void 0,"操作"))),_=(0,r.default)("div",{className:"form-group"},void 0,(0,r.default)("label",{},void 0,(0,r.default)("small",{},void 0,"服务管理"))),w=(0,r.default)("thead",{},void 0,(0,r.default)("tr",{},void 0,(0,r.default)("th",{}),(0,r.default)("th",{},void 0,"服务名"),(0,r.default)("th",{},void 0,"服务状态"),(0,r.default)("th",{},void 0,"管理IP"),(0,r.default)("th",{},void 0,"机柜位置"),(0,r.default)("th",{},void 0,"角色"),(0,r.default)("th",{},void 0,"操作"))),I=(0,r.default)("i",{className:"fa fa-save"}),S=function(e){function a(e){(0,o.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,d.default)(a)).call(this,e));return t.createDataSetHandler=t.createDataSetHandler.bind(t),t.fieldInputHandler=t.fieldInputHandler.bind(t),t.nameListValidate=t.nameListValidate.bind(t),t.ipListValidate=t.ipListValidate.bind(t),t.ipInputHandler=t.ipInputHandler.bind(t),t.RemoveOKHandler=t.RemoveOKHandler.bind(t),t.removeHandler=t.removeHandler.bind(t),t.privilegeHandler=t.privilegeHandler.bind(t),t}return(0,m.default)(a,e),(0,c.default)(a,[{key:"componentWillMount",value:function(){this.props.getNodeServerList(),this.props.getServerList()}},{key:"componentDidMount",value:function(){D={}}},{key:"componentDidUpdate",value:function(){var e=this.props.nodeServerManage,a=e.nodeManage,t=e.serverManage;this.crateTableHandler(a,"nodeList"),this.crateTableHandler(t,"serverList")}},{key:"crateTableHandler",value:function(e,a){var t={id:a,columns:[{className:"textCenter",orderable:!1,data:null,defaultContent:""},{data:"name",orderable:!1},{data:"status",orderable:!1},{data:"ip",orderable:!1},{data:"place",orderable:!1},{data:"role",orderable:!1},{className:"",orderable:!1,data:null,defaultContent:""}],dom:'<"top">rt<"bottom"i>',scrollX:!1,paging:!1,columnDefs:[{targets:0,render:function(e,a,t){return"<span class='row-details row-details-close mt10 hide'></span><i class='fa fa-circle-thin mt10'></i>"}},{targets:6,render:function(e,a,t){var l="";return"删除"==t.privilege.DATASET?l+="<i class='fa fa-trash-o' style='cursor: pointer;' title='删除'></i>":0!==t.privilege.DATASET.length?(t.privilege.DATASET.indexOf("查看")!=-1&&(l+="<a href='javascript:void(0);'  class='datasetDetail btn btn-default btn-xs'  ><i class='fa fa-file-text-o'></i> 详情</a> "),t.privilege.DATASET.indexOf("修改")!=-1&&(l+="<a href='javascript:void(0);' class='datasetEdit btn btn-default btn-xs'><i class='fa fa-pencil-square-o'></i> 修改</a> "),t.privilege.DATASET.indexOf("删除")!=-1&&(l+="<a href='javascript:void(0);' class='datasetRemove btn btn-default btn-xs' data-toggle=\"modal\" data-target=\"#removeDataset\"><i class='fa fa-trash-o'></i> 删除</a> "),t.privilege.DATASET.indexOf("授权")!=-1&&(l+="<a href='javascript:void(0);' class='privilege btn btn-default btn-xs'><i class='fa fa-wrench'></i> 授权</a> ")):l+="<span>  无操作权限<span/>",l}}],data:e},l=(0,H.default)(t);(0,T.bindTableEvent)(a,"click","a.datasetDetail",this.detailHandler),(0,T.bindTableEvent)(a,"click","a.datasetEdit",this.editHandler),(0,T.bindTableEvent)(a,"click","a.datasetRemove",this.removeHandler),(0,T.bindTableEvent)(a,"click","a.privilege",this.privilegeHandler);var i=$("#"+a);i.on("click","tbody td > i.fa-trash-o",function(){var e=$(this).parents("tr"),a=$(this).closest("tr").find("input.name").val().trim(),t=l.row(e);t.remove(),l.draw(),"date"==$(this).closest("tr").find('select[name = "type"]').val()&&delete D[a];for(var i=[],r=0;r<$('select[name = "type"]').length;r++)i.push($('select[name = "type"]').eq(r).val());i.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)})}},{key:"selectRow",value:function(e){var a=$(e.currentTarget).parents("table");return a.DataTable().row($(e.currentTarget).parents("tr")).data()}},{key:"detailHandler",value:function(){}},{key:"editHandler",value:function(){}},{key:"privilegeHandler",value:function(e){var a=this.selectRow(e);this.props.history.replace("/nodeServerManage/accredit/"+a.name)}},{key:"removeHandler",value:function(e){var a=$(e.currentTarget).parents("table").attr("id")+"Remove",t=this.selectRow(e);$("#"+a).modal(),this.refs[a].setContent("您确定要卸载"+t.name+"插件吗？")}},{key:"RemoveOKHandler",value:function(){$(".modal").modal("hide")}},{key:"nameListValidate",value:function(e){var a={name:{presence:{message:"请输入字段名(同级字段不能重名)"},format:{pattern:"^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$",message:"请输入合法字段名"}}};(0,x.baseValidate)($(e.currentTarget).closest($(".nameDiv")),a)}},{key:"ipListValidate",value:function(e){var a={ip:{presence:{message:"请输入IP(同级字段不能重名)"},format:{pattern:"^(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])$",message:"请输入合法IP"}}};(0,x.baseValidate)($(e.currentTarget).closest($(".ipDiv")),a)}},{key:"createDataSetHandler",value:function(){var e={nodeList:[],serverList:[]};if(0!=$("input.name").length)for(var a=$("tbody tr td input.name"),t=0;t<a.length;t++){var l=a.eq(t).closest("table").attr("id"),i=a.eq(t).closest("tr"),r=[a.eq(t),$("select.status",$(i)),$("input.ip",$(i)),$("input.place",$(i)),$("select.role",$(i))],n=r[0],d=r[1],s=r[2],o=r[3],u=r[4];if(""==n.val().trim())return void n.blur();if(""==s.val().trim())return void s.blur();var c={name:n.val(),status:d.val(),ip:s.val(),place:o.val(),role:u.val()};e[l].push(c)}this.props.addNodeServerList(e)}},{key:"handleCreateHandler",value:function(e){var a=e.target||e.srcElement,t=$("#"+a.getAttribute("data-table")),l=t.DataTable();l.row.add({name:'<div class="nameDiv form-group"><input type="text" name="name" placeholder="支持英文、数字、下划线" maxlength= "30" class="name namer form-control"><span class="messages"></span></div>',status:k,ip:'<div class="ipDiv form-group"><input type="text" class="ip form-control" name="ip"><span class="messages"></span></div>',place:'<input type="text" class="place form-control">',role:L,privilege:{DATASET:"删除"}}).draw(),$("input.name",t).blur(this.fieldInputHandler),$('select[name = "type"]',t).change(this.selectTypeHandler),$('select[name = "index"]',t).change(this.selectIndexHandler),$("input.ip",t).blur(this.ipInputHandler)}},{key:"fieldInputHandler",value:function(e){var a=$(e.currentTarget).val().trim(),t=[];if(this.nameListValidate(e),$("input.namer").not($(e.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&t.push($(a).val())}),t.indexOf(a)!=-1)return $(e.currentTarget).val(""),void $(e.currentTarget).blur()}},{key:"ipInputHandler",value:function(e){var a=$(e.currentTarget).val().trim(),t=[];if(this.ipListValidate(e),$("input.namer").not($(e.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&t.push($(a).val())}),t.indexOf(a)!=-1)return $(e.currentTarget).val(""),void $(e.currentTarget).blur()}},{key:"render",value:function(){return(0,r.default)("div",{id:"nodeServerAdd"},void 0,(0,r.default)("div",{className:"box box-primary"},void 0,(0,r.default)("div",{className:"row box-body"},void 0,(0,r.default)("div",{className:"col-md-12"},void 0,N,(0,r.default)("div",{className:"box-header pull-left"},void 0,(0,r.default)("button",{type:"submit",name:"createDataset",className:"btn btn-primary","data-table":"nodeList",onClick:this.handleCreateHandler.bind(this)},void 0,(0,r.default)("i",{className:"fa fa-fw fa-plus-circle",style:{verticalAlign:"middle",padding:"0 8px 0 0"}}),"新增节点")),(0,r.default)("div",{className:"box-body"},void 0,(0,r.default)("table",{id:"nodeList",className:"table table-striped table-bordered",style:{width:"100%"}},void 0,A))))),(0,r.default)("div",{className:"box box-primary"},void 0,(0,r.default)("div",{className:"row box-body"},void 0,(0,r.default)("div",{className:"col-md-12"},void 0,_,(0,r.default)("div",{className:"box-header pull-left"},void 0,(0,r.default)("button",{type:"submit",name:"createDataset",className:"btn btn-primary","data-table":"serverList",onClick:this.handleCreateHandler.bind(this)},void 0,(0,r.default)("i",{className:"fa fa-fw fa-plus-circle",style:{verticalAlign:"middle",padding:"0 8px 0 0"}}),"新建服务")),(0,r.default)("div",{className:"box-body"},void 0,(0,r.default)("table",{id:"serverList",className:"table table-striped table-bordered",style:{width:"100%"}},void 0,w))))),(0,r.default)("button",{name:"saveBtn",className:"btn btn-primary",onClick:this.createDataSetHandler},void 0,I," 保存"),h.default.createElement(y.default,{modalId:"nodeListRemove",ref:"nodeListRemove",title:"节点删除",okHandler:this.RemoveOKHandler}))}}]),a}(b.Component);a.default=S}});